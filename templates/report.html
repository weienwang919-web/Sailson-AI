-item';
                    li.innerText = item.title;
                    li.onclick = async () => {
                        const r = await fetch(`/get_record/${item.id}`);
                        const d = await r.json();
                        document.getElementById('output').innerHTML = d.result;
                    };
                    ul.appendChild(li);
                }
            });
        }
    </script>
</body>
</html><!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ™ºèƒ½å‘¨æŠ¥ | Sailson AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="{{ url_for('static', filename='logo.png') }}">
    <style>
        :root { --primary-color: #2E7D32; --bg-color: #FAFAFA; --sidebar-width: 280px; }
        body { background-color: var(--bg-color); font-family: 'Inter', sans-serif; height: 100vh; display: flex; overflow: hidden;}
        
        .sidebar { width: var(--sidebar-width); background: #fff; border-right: 1px solid #E5E5E5; padding: 20px; display: flex; flex-direction: column; }
        .sidebar-header { margin-bottom: 30px; display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .sidebar-logo { height: 32px; width: auto; }
        .sidebar-title { font-weight: 700; font-size: 1.1rem; }
        .new-chat-btn { background: var(--primary-color); color: white; border: none; padding: 12px; border-radius: 10px; width: 100%; font-weight: 600; margin-bottom: 20px; transition: 0.2s; }
        .new-chat-btn:hover { background: #1B5E20; transform: translateY(-1px); }
        .history-list { flex-grow: 1; overflow-y: auto; list-style: none; padding: 0; }
        .history-item { padding: 10px 14px; border-radius: 8px; cursor: pointer; font-size: 0.9rem; color: #333; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .history-item:hover { background: #F5F5F7; }
        .history-item.active { background: #E8F5E9; color: var(--primary-color); font-weight: 600; }
        .back-home { margin-top: auto; padding-top: 20px; border-top: 1px solid #eee; text-decoration: none; color: #666; font-size: 0.9rem; }

        .main-content { flex-grow: 1; padding: 40px; overflow-y: auto; }
        .container-box { max-width: 1000px; margin: 0 auto; }
        .glass-card { background: #fff; border: 1px solid #E5E5E5; border-radius: 20px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.02); }
        .form-label { font-weight: 600; margin-top: 10px; font-size: 0.9rem; }
        .form-control { padding: 12px; border-radius: 10px; border: 1px solid #E0E0E0; }
        .btn-generate { background: var(--primary-color); color: white; border: none; padding: 12px; border-radius: 10px; width: 100%; font-weight: 600; margin-top: 20px; }
        
        /* æ‰“å­—æœºå…‰æ ‡æ•ˆæœ */
        .cursor {
            display: inline-block;
            width: 8px;
            height: 18px;
            background-color: var(--primary-color);
            animation: blink 1s infinite;
            vertical-align: middle;
            margin-left: 2px;
        }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }

        /* é‚®ä»¶å†…å®¹æ ·å¼ */
        #output { 
            white-space: pre-wrap; 
            line-height: 1.8; 
            font-family: 'Inter', sans-serif;
            color: #333;
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-header" onclick="location.reload()">
            <img src="{{ url_for('static', filename='logo.png') }}" class="sidebar-logo">
            <span class="sidebar-title">å‘¨æŠ¥åŠ©æ‰‹</span>
        </div>
        <button onclick="location.reload()" class="new-chat-btn">+ æ–°å‘¨æŠ¥</button>
        <div class="text-muted small fw-bold mb-2">å†å²å‘¨æŠ¥</div>
        <ul class="history-list" id="historyList"></ul>
        <a href="/" class="back-home">â† è¿”å›é¦–é¡µ</a>
    </aside>

    <main class="main-content">
        <div class="container-box">
            <h2 class="fw-bold mb-4">æ™ºèƒ½å‘¨æŠ¥ç”Ÿæˆ</h2>
            <div class="row g-4">
                <div class="col-md-5">
                    <div class="glass-card">
                        <label class="form-label">å…³é”®æ•°æ®</label>
                        <textarea class="form-control" id="metrics" rows="2" placeholder="DAU +5%..."></textarea>
                        <label class="form-label">æœ¬å‘¨è¿›å±•</label>
                        <textarea class="form-control" id="progress" rows="3" placeholder="ä¸Šçº¿æ–°åŠŸèƒ½..."></textarea>
                        <label class="form-label">ä¸‹å‘¨è®¡åˆ’</label>
                        <textarea class="form-control" id="plan" rows="2" placeholder="è·Ÿè¿›æ´»åŠ¨..."></textarea>
                        <button onclick="genReport()" id="btn" class="btn-generate">âœ¨ ç”Ÿæˆé‚®ä»¶</button>
                    </div>
                </div>
                <div class="col-md-7">
                    <div class="glass-card" style="min-height: 500px; background: #fff;">
                        <div id="outputContainer">
                            <div id="placeholder" class="text-center text-muted py-5 mt-5">
                                <div style="font-size: 40px;">ğŸ“§</div>
                                <p>é‚®ä»¶é¢„è§ˆåŒº</p>
                            </div>
                            <div id="output" style="display: none;"></div>
                        </div>
                        
                        <div id="loading" class="text-center py-5" style="display: none;">
                            <div class="spinner-border text-success"></div>
                            <p class="mt-2 text-muted fw-bold" id="loadingText">AI æ­£åœ¨æ€è€ƒ...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        window.onload = loadHistory;

        async function genReport() {
            const metrics = document.getElementById('metrics').value;
            const progress = document.getElementById('progress').value;
            const plan = document.getElementById('plan').value;
            
            if(!metrics) { alert("è¯·å†™ç‚¹å†…å®¹"); return; }
            
            // 1. UI çŠ¶æ€åˆ‡æ¢
            document.getElementById('placeholder').style.display = 'none';
            document.getElementById('output').style.display = 'none';
            document.getElementById('output').innerHTML = ''; // æ¸…ç©ºæ—§å†…å®¹
            document.getElementById('loading').style.display = 'block';
            document.getElementById('btn').disabled = true;

            // 2. å¯åŠ¨â€œæ™ºèƒ½æ€è€ƒâ€åŠ¨ç”» (æ¯ 800ms æ¢ä¸€å¥è¯)
            const loadingTexts = ["ğŸš€ æ­£åœ¨è¿æ¥é€šä¹‰åƒé—®...", "ğŸ§  æ­£åœ¨æ¢³ç†å·¥ä½œé€»è¾‘...", "âœï¸ æ­£åœ¨æ¶¦è‰²èŒåœºæœ¯è¯­...", "ğŸ“§ æ­£åœ¨ç”Ÿæˆé‚®ä»¶æ ¼å¼..."];
            let step = 0;
            const timer = setInterval(() => {
                document.getElementById('loadingText').innerText = loadingTexts[step % loadingTexts.length];
                step++;
            }, 800);

            try {
                // 3. è¯·æ±‚ API
                const res = await fetch('/generate_report', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ metrics, progress, plan })
                });
                const data = await res.json();
                
                // 4. æ¸…é™¤ Loadingï¼Œå¼€å§‹æ‰“å­—
                clearInterval(timer);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('output').style.display = 'block';
                
                // âœ¨ å¯åŠ¨æ‰“å­—æœºç‰¹æ•ˆ
                typeWriterEffect(data.result);
                
                loadHistory();

            } catch (error) {
                clearInterval(timer);
                document.getElementById('loading').innerHTML = `<span class="text-danger">ç”Ÿæˆå¤±è´¥: ${error}</span>`;
            } finally {
                document.getElementById('btn').disabled = false;
            }
        }

        // âœ¨ æ‰“å­—æœºæ ¸å¿ƒå‡½æ•°
        function typeWriterEffect(text) {
            const output = document.getElementById('output');
            output.innerHTML = ''; // æ¸…ç©º
            let i = 0;
            const speed = 20; // æ‰“å­—é€Ÿåº¦ (è¶Šå°è¶Šå¿«)

            function type() {
                if (i < text.length) {
                    // å¦‚æœé‡åˆ°æ¢è¡Œç¬¦ï¼Œå¤„ç†ä¸€ä¸‹
                    if (text.charAt(i) === '\n') {
                        output.innerHTML += '<br>';
                    } else {
                        output.innerHTML += text.charAt(i);
                    }
                    i++;
                    
                    // åŠ ä¸ªå…‰æ ‡
                    if (!document.getElementById('cursor')) {
                        output.innerHTML += '<span id="cursor" class="cursor"></span>';
                    } else {
                        // ç§»åŠ¨å…‰æ ‡åˆ°æœ€å
                        const cursor = document.getElementById('cursor');
                        output.appendChild(cursor); 
                    }
                    
                    setTimeout(type, speed);
                } else {
                    // æ‰“å­—ç»“æŸï¼Œç§»é™¤å…‰æ ‡
                    const cursor = document.getElementById('cursor');
                    if(cursor) cursor.style.display = 'none';
                }
            }
            type();
        }

        async function loadHistory() {
            const res = await fetch('/get_history');
            const list = await res.json();
            const ul = document.getElementById('historyList');
            ul.innerHTML = '';
            list.forEach(item => {
                if(item.type === 'report') {
                    const li = document.createElement('li');
                    li.className = 'history-item';
                    li.innerText = item.title;
                    li.onclick = async () => {
                        const r = await fetch(`/get_record/${item.id}`);
                        const d = await r.json();
                        // å†å²è®°å½•ç›´æ¥æ˜¾ç¤ºï¼Œä¸ç”¨æ‰“å­—æœº
                        document.getElementById('placeholder').style.display = 'none';
                        document.getElementById('output').style.display = 'block';
                        document.getElementById('output').innerHTML = d.result;
                    };
                    ul.appendChild(li);
                }
            });
        }
    </script>
</body>
</html>